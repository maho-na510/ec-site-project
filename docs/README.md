# ECサイト - ドキュメント

このディレクトリには、ECサイトプロジェクトの設計ドキュメントが含まれています。

## ドキュメント一覧

### 📊 [ER_Diagram.md](ER_Diagram.md) - データベース設計
データベースのエンティティ関係図とテーブル定義

**主要エンティティ**:
- `users` - ユーザーアカウント（顧客）
- `admins` - 管理者アカウント
- `products` - 商品カタログ
- `categories` - 商品カテゴリ
- `orders` - 注文
- `cart_items` - ショッピングカート
- `inventory_logs` - 在庫変更履歴

### 📋 [Requirements_Definition.md](Requirements_Definition.md) - 要件定義
機能要件と非機能要件の詳細定義

**主要セクション**:
1. プロジェクト概要と目的
2. 機能要件
   - ユーザー機能（登録、ログイン、商品閲覧、カート、注文）
   - 管理者機能（商品管理、在庫管理、レポート）
3. 非機能要件
   - セキュリティ要件
   - パフォーマンス要件
   - 可用性要件

### 🏗️ [System_Design.md](System_Design.md) - システム設計
アーキテクチャ設計と技術選定の詳細

**主要セクション**:
1. アーキテクチャ概要
   - マイクロサービス指向アーキテクチャ
   - Rails（ユーザーAPI）+ Laravel（管理者API）
2. 技術スタック選定理由
3. セキュリティ設計
4. データベース設計
5. API設計
6. デプロイメント戦略

### 🔄 [Component_Diagram.md](Component_Diagram.md) - コンポーネント図
システムコンポーネントの関係と データフロー

**主要セクション**:
1. システム全体図
2. フロントエンド構成
3. バックエンド構成
4. データフロー図

## クイックリファレンス

### データベーススキーマ

```
[Users] ─┬─ [Orders] ── [OrderItems] ── [Products]
         └─ [CartItems] ────────────────┘
                                         │
[Admins] ─┬─ [Products] ── [Categories]
          └─ [InventoryLogs]
```

### アーキテクチャ

```
React Frontend (:5173)
    │
    ├─→ Rails API (:3001)     [ユーザー向け]
    │   └─→ MySQL + Redis
    │
    └─→ Laravel API (:8000)   [管理者向け]
        └─→ MySQL + Redis (共有)
```

### 主要技術

| レイヤー | 技術 |
|---------|------|
| フロントエンド | React 18 + TypeScript + Vite + Tailwind CSS |
| ユーザーAPI | Ruby on Rails 7.1 |
| 管理者API | Laravel 11 |
| データベース | MySQL 8.0 (共有) |
| キャッシュ/セッション | Redis 7 |
| コンテナ | Docker + docker-compose |
| テスト | Minitest + PHPUnit + Jest |

## 設計の重要な決定事項

### 1. マイクロサービス指向アーキテクチャ
- **理由**: ユーザーと管理者の関心事を分離
- **利点**: 独立したスケーリング、セキュリティ境界の明確化
- **トレードオフ**: 運用の複雑さが増加

### 2. データベース共有
- **理由**: データの一貫性を保証、トランザクション管理の簡素化
- **実装**: RailsとLaravelが同じMySQLデータベースを使用
- **注意点**: マイグレーション管理の調整が必要

### 3. JWT認証
- **理由**: ステートレス認証、水平スケーリングが容易
- **実装**: ユーザーと管理者で別々のトークン
- **セキュリティ**: Redisでトークンのブラックリスト管理

### 4. 直接日本語UI
- **理由**: i18nライブラリを使用せず、コンポーネントに直接日本語を記述
- **利点**: シンプル、パフォーマンス向上
- **制約**: 多言語対応が難しい（現時点では不要）

### 5. テスト戦略
- **ユニットテスト**: 70%（モデル、サービス）
- **統合テスト**: 20%（API、コントローラー）
- **E2Eテスト**: 10%（将来実装予定）

## セキュリティ対策

### 認証・認可
- JWT トークンベース認証
- bcrypt パスワードハッシュ化
- CORS 制限
- レート制限

### データ保護
- SQL インジェクション防止（ORM使用）
- XSS 防止（React自動エスケープ）
- CSRF 保護
- HTTPSのみ（本番環境）

### 在庫管理
- トランザクションロック（同時購入対策）
- 楽観的ロック（在庫更新）
- 在庫変更の監査ログ

## パフォーマンス最適化

### データベース
- 外部キーのインデックス
- クエリの複合インデックス
- N+1クエリ防止（eager loading）

### キャッシュ
- Redisによる商品リストキャッシュ（5分TTL）
- セッション管理
- API レスポンスキャッシュ

### フロントエンド
- コード分割
- 画像の遅延読み込み
- React Query によるサーバーキャッシュ

## 開発ワークフロー

1. **計画**: 要件定義 → システム設計
2. **実装**: テスト駆動開発（TDD）
3. **テスト**: ユニット → 統合 → E2E
4. **デプロイ**: Docker経由で本番環境へ

## 今後の拡張

- [ ] 決済システム統合（Stripe）
- [ ] メール通知システム
- [ ] レコメンデーション機能
- [ ] 管理者ダッシュボード
- [ ] CSVレポート生成
- [ ] E2Eテスト（Cypress）

---

**最終更新**: 2025-12-25

詳細については、各ドキュメントを参照してください。
